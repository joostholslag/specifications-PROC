<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="description" content="openEHR Decision Language specification">
<meta name="keywords" content="expressions, rules, guidelines">
<title>Decision Language specification</title>
<link rel="stylesheet" href="https://specifications.openehr.org/styles/openehr.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_decision_language_specification">Decision Language specification</a>
<ul class="sectlevel1">
<li><a href="#_amendment_record">Amendment Record</a></li>
<li><a href="#_acknowledgements">Acknowledgements</a>
<ul class="sectlevel2">
<li><a href="#_primary_author">Primary Author</a></li>
</ul>
</li>
<li><a href="#_preface">1. Preface</a>
<ul class="sectlevel2">
<li><a href="#_purpose">1.1. Purpose</a></li>
<li><a href="#_related_documents">1.2. Related Documents</a></li>
<li><a href="#_status">1.3. Status</a></li>
<li><a href="#_feedback">1.4. Feedback</a></li>
<li><a href="#_conformance">1.5. Conformance</a></li>
</ul>
</li>
<li><a href="#_overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_requirements">2.1. Requirements</a>
<ul class="sectlevel3">
<li><a href="#_caller_interaction">2.1.1. Caller Interaction</a></li>
<li><a href="#_representation">2.1.2. Representation</a></li>
<li><a href="#_binding_to_data_context">2.1.3. Binding to Data Context</a></li>
<li><a href="#_type_system">2.1.4. Type System</a></li>
</ul>
</li>
<li><a href="#_execution_model">2.2. Execution Model</a></li>
</ul>
</li>
<li><a href="#_decision_logic_module_dlm_formalism">3. Decision Logic Module (DLM) Formalism</a>
<ul class="sectlevel2">
<li><a href="#_identifiers">3.1. Identifiers</a></li>
<li><a href="#_identification_section">3.2. Identification Section</a></li>
<li><a href="#_language_and_description_sections">3.3. Language and Description Sections</a></li>
<li><a href="#_use_model_section">3.4. Use_model Section</a></li>
<li><a href="#_use_section">3.5. Use Section</a></li>
<li><a href="#_preconditions_section">3.6. Preconditions Section</a></li>
<li><a href="#_reference_section">3.7. Reference Section</a></li>
<li><a href="#_input_section">3.8. Input Section</a>
<ul class="sectlevel3">
<li><a href="#_subject_variable_naming">3.8.1. Subject Variable Naming</a></li>
<li><a href="#_currency">3.8.2. Currency</a></li>
<li><a href="#_time_window">3.8.3. Time-window</a></li>
<li><a href="#_variable_ranges">3.8.4. Variable Ranges</a></li>
<li><a href="#_null_values">3.8.5. Null Values</a></li>
</ul>
</li>
<li><a href="#_rules_section">3.9. Rules Section</a></li>
<li><a href="#_output_section">3.10. Output Section</a></li>
</ul>
</li>
<li><a href="#_the_decision_logic_model_dlm">4. The Decision Logic Model (DLM)</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">4.1. Overview</a></li>
<li><a href="#_ds_module_package">4.2. DS Module Package</a>
<ul class="sectlevel3">
<li><a href="#_class_descriptions">4.2.1. Class Descriptions</a>
<ul class="sectlevel4">
<li><a href="#_decision_module_class">4.2.1.1. DECISION_MODULE Class</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ds_rules_package">4.3. DS Rules Package</a>
<ul class="sectlevel3">
<li><a href="#_condition_chain_rule">4.3.1. Condition Chain Rule</a></li>
<li><a href="#_case_rule">4.3.2. Case Rule</a></li>
<li><a href="#_class_descriptions_2">4.3.3. Class Descriptions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_references">References</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="https://specifications.openehr.org/images/openEHR_logo_RGB.svg" alt="openEHR logo">
</div>
</div>
</div>
</div>
<h1 id="_decision_language_specification" class="sect0"><a class="anchor" href="#_decision_language_specification"></a>Decision Language specification</h1>
<div class="openblock partintro">
<div class="content">
<table class="tableblock frame-all grid-all fit-content spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2"><strong>Issuer</strong>: <a href="https://www.openehr.org/programs/specification" target="_blank" rel="noopener">openEHR Specification Program</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Release</strong>: PROC latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong>: DEVELOPMENT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Revision</strong>: <a href="#latest_issue">[latest_issue]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Date</strong>: <a href="#latest_issue_date">[latest_issue_date]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Keywords</strong>: expressions, rules, guidelines</p></td>
</tr>
</tbody>
</table>
<div class="imageblock text-center">
<div class="content">
<object type="image/svg+xml" data="openehr_block_diagram.svg" width="60%"><span class="alt">openEHR components</span></object>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">&#169; 2020 - 2020 The openEHR Foundation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><a href="https://www.openehr.org" target="_blank" rel="noopener">The openEHR Foundation</a> is an independent, non-profit foundation, facilitating the sharing of health records by consumers and clinicians via open specifications, clinical models and open platform implementations.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Licence</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="https://specifications.openehr.org/images/cc-by-nd-88x31.png" alt="image"></span> Creative Commons Attribution-NoDerivs 3.0 Unported. <a href="https://creativecommons.org/licenses/by-nd/3.0/" class="bare">https://creativecommons.org/licenses/by-nd/3.0/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Support</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issues: <a href="https://specifications.openehr.org/components/PROC/open_issues" target="_blank" rel="noopener">Problem Reports</a><br>
 Web: <a href="https://specifications.openehr.org" target="_blank" rel="noopener">specifications.openEHR.org</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_amendment_record"><a class="anchor" href="#_amendment_record"></a>Amendment Record</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 54.5454%;">
<col style="width: 18.1818%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Issue</th>
<th class="tableblock halign-left valign-top">Details</th>
<th class="tableblock halign-left valign-top">Raiser, Implementer</th>
<th class="tableblock halign-left valign-top">Completed</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>PROC Release 2.0.0 (unreleased)</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue"></a>0.5.0</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://specifications.openehr.org/tickets/SPECPROC-41" target="_blank" rel="noopener">SPECPROC-41</a>. Add Decision Language specification.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue_date"></a>13 Feb 2020</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>Acknowledgements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_primary_author"><a class="anchor" href="#_primary_author"></a>Primary Author</h3>
<div class="ulist">
<ul>
<li>
<p>Thomas Beale, Ars Semantica; openEHR Foundation Management Board.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose"><a class="anchor" href="#_purpose"></a>1.1. Purpose</h3>
<div class="paragraph">
<p>This document specifies the openEHR Decision Language, in both abstract syntax form and as a related model. The latter defines the semantics of a first order predicate style logic that can be used to write Decision Logic Modules (DLMs) containing rule-sets that may be used standalone or with a Process / Plan oriented system such as <a href="https://specifications.openehr.org/releases/PROC/latest/task_planning.html" target="_blank" rel="noopener">openEHR Task Planning</a>.</p>
</div>
<div class="paragraph">
<p>The intended audience includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Standards bodies producing health informatics standards;</p>
</li>
<li>
<p>Academic groups using openEHR;</p>
</li>
<li>
<p>Solution vendors.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_documents"><a class="anchor" href="#_related_documents"></a>1.2. Related Documents</h3>
<div class="paragraph">
<p>Prerequisite documents for reading this document include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://specifications.openehr.org/releases/BASE/latest/architecture_overview.html" target="_blank" rel="noopener">openEHR Architecture Overview</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Related documents include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://specifications.openehr.org/releases/PROC/latest/task_planning.html" target="_blank" rel="noopener">openEHR Task Planning specification</a>;</p>
</li>
<li>
<p>The <a href="https://specifications.openehr.org/releases/CDS/latest/GDL2.html" target="_blank" rel="noopener">Guideline Definition Language (GDL2)</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_status"><a class="anchor" href="#_status"></a>1.3. Status</h3>
<div class="paragraph">
<p>This specification is in the DEVELOPMENT state. The development version of this document can be found at <a href="https://specifications.openehr.org/releases/PROC/latest/decision_language.html" target="_blank" rel="noopener">https://specifications.openehr.org/releases/PROC/latest/decision_language.html</a>.</p>
</div>
<div class="paragraph">
<p>Known omissions or questions are indicated in the text with a 'to be determined' paragraph, as follows:</p>
</div>
<div class="paragraph tbd">
<p><strong>TBD</strong>: (example To Be Determined paragraph)</p>
</div>
</div>
<div class="sect2">
<h3 id="_feedback"><a class="anchor" href="#_feedback"></a>1.4. Feedback</h3>
<div class="paragraph">
<p>Feedback may be provided on the <a href="https://discourse.openehr.org/c/specifications/task-planning-gdl" target="_blank" rel="noopener">process specifications forum</a>.</p>
</div>
<div class="paragraph">
<p>Issues may be raised on the <a href="https://specifications.openehr.org/components/PROC/open_issues" target="_blank" rel="noopener">specifications Problem Report tracker</a>.</p>
</div>
<div class="paragraph">
<p>To see changes made due to previously reported issues, see the <a href="https://specifications.openehr.org/components/PROC/history" target="_blank" rel="noopener">PROC component Change Request tracker</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conformance"><a class="anchor" href="#_conformance"></a>1.5. Conformance</h3>
<div class="paragraph">
<p>Conformance of a data or software artifact to an openEHR specification is determined by a formal test of that artifact against the relevant <a href="https://specifications.openehr.org/releases/ITS/latest/index" target="_blank" rel="noopener">openEHR Implementation Technology Specification(s) (ITSs)</a>, such as an IDL interface or an XML-schema. Since ITSs are formal derivations from underlying models, ITS conformance indicates model conformance.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The openEHR Decision Language (DL) and model defines a formalism for expressing decision logic and rules used by process-oriented healthcare information systems, active forms and so on. Decision logic usually sits within a larger environment of plans, guidelines and data sources such as the EHR, as described in the <a href="https://specifications.openehr.org/releases/PROC/latest/overview.html#_conceptual_framework" target="_blank" rel="noopener">openEHR Process and Planning Overview</a>. The primary encapsulation of DL is within a Decision Logic Module (DLM).</p>
</div>
<div class="paragraph">
<p>Within the openEHR ecosystem, Task Plans and GDL3 guidelines both require a way of expressing rules and declaring input variables. Guidelines additionally need a way of declaring output variables. These needs are achieved with the flexible use of a single kind of multi-section module called a decision logic module (DLM).</p>
</div>
<div class="paragraph">
<p>The Decision Language is a high-level language in which modules containing the following elements may be written:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>reference data</em>: domain constants;</p>
</li>
<li>
<p><em>input variables</em>: data items representing external variables relating to the subject (i.e. patient);</p>
</li>
<li>
<p><em>conditions</em>: Boolean-returning domain-specified criteria;</p>
</li>
<li>
<p><em>rules</em>: domain-specified rules structures based on condition/action structures, which may return any type;</p>
</li>
<li>
<p><em>rule-sets</em>: related sets of rules in various forms, including decision tables;</p>
</li>
<li>
<p><em>outputs</em>: computed results of rule invocations, including logic trace information;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All symbolic elements, including constants, variables and rules may be treated as <em>codes</em> for which a translation terminology is supplied, enabling a DLM to be translated and presented in any natural language.</p>
</div>
<div class="sect2">
<h3 id="_requirements"><a class="anchor" href="#_requirements"></a>2.1. Requirements</h3>
<div class="paragraph">
<p>The requirements of openEHR Decision Language fall into a number of categories, described below.</p>
</div>
<div class="paragraph tbd">
<p>TBD: this section only very rough for now.</p>
</div>
<div class="sect3">
<h4 id="_caller_interaction"><a class="anchor" href="#_caller_interaction"></a>2.1.1. Caller Interaction</h4>
<div class="ulist">
<ul>
<li>
<p>the ability to capture the reasoning chain for presentation to a caller as a justification;</p>
</li>
<li>
<p>the ability to provide a decision and its possible outcomes, with the current recommendation indicated;</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_representation"><a class="anchor" href="#_representation"></a>2.1.2. Representation</h4>
<div class="ulist">
<ul>
<li>
<p>multi-lingual translations for symbolic variables, in a similar way to the <a href="https://specifications.openehr.org/releases/AM/latest/ADL2.html" target="_blank" rel="noopener">openEHR Archetype Definition Language (ADL2)</a>;</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_binding_to_data_context"><a class="anchor" href="#_binding_to_data_context"></a>2.1.3. Binding to Data Context</h4>
<div class="ulist">
<ul>
<li>
<p>bindings that connect variables to external data sources;</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_type_system"><a class="anchor" href="#_type_system"></a>2.1.4. Type System</h4>
<div class="ulist">
<ul>
<li>
<p>an ability to use externally defined information models that supply types that may be used in DL statements.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_execution_model"><a class="anchor" href="#_execution_model"></a>2.2. Execution Model</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_decision_logic_module_dlm_formalism"><a class="anchor" href="#_decision_logic_module_dlm_formalism"></a>3. Decision Logic Module (DLM) Formalism</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The openEHR Decision Language (DL) is primarily used to write Decision Logic Modules (DLMs). A DLM has the following general structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dlm &lt;form&gt; &lt;identifier&gt;

[language
    &lt;lang and translations meta-data, as for archetypes&gt;]

[description
    &lt;descriptive meta-data&gt;]

[use_model
    &lt;reference model ids; defaults to openEHR Foundation &amp; Base types&gt;]

[use
    &lt;local identifier&gt;: &lt;dlm identifier&gt;
    &lt;local identifier&gt;: &lt;dlm identifier&gt;]

[preconditions
    &lt;conditions that act as pre-conditions for this module&gt;]

[reference
    &lt;constant definitions&gt;]

input
    &lt;subject variable declarations&gt;

rules
    &lt;conditions and rules expressed as EL functions&gt;

[output
    &lt;output variable declarations&gt;]

[terminology
    &lt;symbol definitions in archetype format&gt;]

[bindings
    &lt;local bindings of symbols to data set paths&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>Many of the sections are optional and are only used in specific <em>forms</em> of DLM, indicated by the <code>&lt;form&gt;</code> on the first line.</p>
</div>
<div class="paragraph">
<p>The <code>language</code>, <code>description</code> and <code>terminology</code> sections (which are identical in form to the same-named sections in openEHR archetypes) can be omitted for DLMs in development for which no descriptive meta-data or terminology is needed.</p>
</div>
<div class="sect2">
<h3 id="_identifiers"><a class="anchor" href="#_identifiers"></a>3.1. Identifiers</h3>
<div class="paragraph">
<p>All identifiers in a DLM are strings with no whitespace. If the <code>terminology</code> section is present, these identifiers are included with linguistic definitions and translations, in the same way as archetypes. This approach enables the symbolic variables such as <code>is_type1_diabetic</code> to be used in rules, and to have a full, formal, multi-lingual definition, such as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="odin"><span></span><span class="tok-nc">terminology</span>
    <span class="tok-nc">term_definitions</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span>
        <span class="tok-p">[</span><span class="tok-s">&quot;en&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span>
            <span class="tok-p">[</span><span class="tok-s">&quot;resting_heart_rate&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span>
                <span class="tok-nc">text</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span><span class="tok-s">&quot;heart rate at rest&quot;</span><span class="tok-p">&gt;</span>
                <span class="tok-nc">description</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span><span class="tok-s">&quot;...&quot;</span><span class="tok-p">&gt;</span>
            <span class="tok-p">&gt;</span>
            <span class="tok-p">...</span>
            <span class="tok-p">[</span><span class="tok-s">&quot;SpO2&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span>
                <span class="tok-nc">text</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span><span class="tok-s">&quot;Oxygen saturation&quot;</span><span class="tok-p">&gt;</span>
                <span class="tok-nc">description</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span><span class="tok-s">&quot;...&quot;</span><span class="tok-p">&gt;</span>
            <span class="tok-p">&gt;</span>
        <span class="tok-p">&gt;</span>
    <span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_identification_section"><a class="anchor" href="#_identification_section"></a>3.2. Identification Section</h3>
<div class="paragraph">
<p>The identification section takes the form <code>dlm &lt;form&gt; &lt;identifier&gt;</code>, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;form&gt;</code>: flavour of DLM artefact, with value <code>ruleset | guideline</code>;</p>
</li>
<li>
<p><code>&lt;identifier&gt;</code>: identifier, in the format <code>&lt;concept&gt;.vN.N.N</code> where <code>vN.N.N</code> represents a numeric version of the logical form <code>major.minor.patch</code>, and whose values over time obey the <a href="http://semver.org" target="_blank" rel="noopener">Semver.org rules</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following shows the identification line for a guideline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dlm guideline chadvasc2.v1.0.5</pre>
</div>
</div>
<div class="paragraph">
<p>A reference to a DLM may be effected by quoting the whole identifier, or a form with the minor and / or patch parts of the version missing. Either of these forms identify the most recent matching DLm available. For example, the reference <code>NHS-chops14.v4</code> identifies whatever the most recent minor version of the <code>v4</code> major version of the NHS-chops DLM is locally available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_language_and_description_sections"><a class="anchor" href="#_language_and_description_sections"></a>3.3. Language and Description Sections</h3>
<div class="paragraph">
<p>The <code>language</code> and <code>description</code> sections are the same as for openEHR archetypes, and are formally defined by the <a href="https://specifications.openehr.org/releases/BASE/latest/resource.html" target="_blank" rel="noopener">openEHR Resource specification</a>. The following provides an example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="odin"><span></span><span class="tok-nc">language</span>
    <span class="tok-nc">original_language</span> <span class="tok-o">=</span> <span class="tok-p">&lt;[</span><span class="tok-nd">ISO_639-1</span><span class="tok-p">::</span><span class="tok-nd">en</span><span class="tok-p">]&gt;</span>

<span class="tok-nc">description</span>
    <span class="tok-nc">lifecycle_state</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span><span class="tok-s">&quot;stable&quot;</span><span class="tok-p">&gt;</span>
    <span class="tok-nc">original_author</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span>
        <span class="tok-p">[</span><span class="tok-s">&quot;name&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span><span class="tok-s">&quot;Rong Chen&quot;</span><span class="tok-p">&gt;</span>
        <span class="tok-p">[</span><span class="tok-s">&quot;date&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span><span class="tok-s">&quot;2020-03-22&quot;</span><span class="tok-p">&gt;</span>
    <span class="tok-p">&gt;</span>
    <span class="tok-nc">details</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span>
        <span class="tok-p">[</span><span class="tok-s">&quot;en&quot;</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span>
            <span class="tok-nc">language</span> <span class="tok-o">=</span> <span class="tok-p">&lt;[</span><span class="tok-nd">ISO_639-1</span><span class="tok-p">::</span><span class="tok-nd">en</span><span class="tok-p">]&gt;</span>
            <span class="tok-nc">purpose</span> <span class="tok-o">=</span> <span class="tok-p">&lt;</span><span class="tok-s">&quot;Simple cardiology guideline&quot;</span><span class="tok-p">&gt;</span>
        <span class="tok-p">&gt;</span>
    <span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_use_model_section"><a class="anchor" href="#_use_model_section"></a>3.4. Use_model Section</h3>
<div class="paragraph">
<p>The optional <code>use_model</code> section enables a DLM to specify a model that defines the type system for the DLM. The identifier of the model must be resolvable to a BMM model, i.e. a model for which an <a href="https://specifications.openehr.org/releases/LANG/latest/bmm.html" target="_blank" rel="noopener">openEHR Basic Meta-Model</a> file is available. This might be a well-known model such as the <a href="https://specifications.openehr.org/releases/RM/latest/index" target="_blank" rel="noopener">openEHR Reference Model</a> (<a href="https://specifications.openehr.org/releases/ITS/latest" target="_blank" rel="noopener">BMM form</a>), or a custom model created for local use. The model identifier must include a version matching part, with at least the major version present. The following example specifies the use of the openEHR RM in the latest <code>1.1</code> version available.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>use_model
    openEHR-RM.v1.1</pre>
</div>
</div>
<div class="paragraph">
<p>The types defined in all 'used' models become available to the DLM for use in declarations. If no model is specified, the <a href="https://specifications.openehr.org/releases/BASE/latest" target="_blank" rel="noopener">openEHR Base and Foundation types</a> are assumed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_section"><a class="anchor" href="#_use_section"></a>3.5. Use Section</h3>
<div class="paragraph">
<p>A DLM can use other DLMs, by declaring each DLM with an identifier in the <code>use</code> section. The identifier must include a version-matching part. The following example declares the identifier <code>BSA</code> as a convenient local label to refer to the latest version of the DLM <code>Body_surface_area.v1</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>use
    BSA: Body_surface_area.v1</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_preconditions_section"><a class="anchor" href="#_preconditions_section"></a>3.6. Preconditions Section</h3>
<div class="paragraph">
<p>The <code>preconditions</code> section is used to state logical conditions that must evaluate to true for the DLM to be used for the subject. Any Boolean-typed identifier may be used from the <code>input</code>, <code>condition</code> or <code>rules</code> sections, or any Boolean-returning logical expression referencing any identifiers declared in the DLM. A typical <code>preconditions</code> section is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>preconditions
    is_pregnant</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reference_section"><a class="anchor" href="#_reference_section"></a>3.7. Reference Section</h3>
<div class="paragraph">
<p>The <code>reference</code> section of a DLM contains what might be thought of constant definitions, i.e. identifiers declared with fixed values. The following illustrates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span><span class="tok-n">reference</span>
    <span class="tok-n">paracetamol_dose</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span> <span class="tok-p">=</span> <span class="tok-m">1</span><span class="tok-n">g</span>
    <span class="tok-n">chlorphenamine_dose</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span> <span class="tok-p">=</span> <span class="tok-m">10</span><span class="tok-n">mg</span>
    <span class="tok-n">prednisolone_dose_per_m2</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span> <span class="tok-p">=</span> <span class="tok-m">40</span><span class="tok-n">mg</span>
    <span class="tok-n">rituximab_dose_per_m2</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span> <span class="tok-p">=</span> <span class="tok-m">375</span><span class="tok-n">mg</span>
    <span class="tok-n">doxorubicin_dose_per_m2</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span> <span class="tok-p">=</span> <span class="tok-m">50</span><span class="tok-n">mg</span>
    <span class="tok-n">vincristine_dose_per_m2</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span> <span class="tok-p">=</span> <span class="tok-m">1.4</span><span class="tok-n">mg</span>
    <span class="tok-n">cyclophosphamide_dose_per_m2</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span> <span class="tok-p">=</span> <span class="tok-m">750</span><span class="tok-n">mg</span>
    <span class="tok-n">cycle_period</span><span class="tok-p">:</span> <span class="tok-n">Duration</span> <span class="tok-p">=</span> <span class="tok-m">3</span><span class="tok-n">w</span>
    <span class="tok-n">cycle_repeats</span><span class="tok-p">:</span> <span class="tok-n">Integer</span> <span class="tok-p">=</span> <span class="tok-m">6</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_input_section"><a class="anchor" href="#_input_section"></a>3.8. Input Section</h3>
<div class="paragraph">
<p>The <code>input</code> section contains declarations of all <em>subject variables</em> used by a DLM. At a minimum, a subject variable declaration states the symbolic name and type of the variable in the manner typical of a typed programming language, as exemplified by the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span><span class="tok-n">input</span>
    <span class="tok-n">heart_rate</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_subject_variable_naming"><a class="anchor" href="#_subject_variable_naming"></a>3.8.1. Subject Variable Naming</h4>
<div class="paragraph">
<p>The naming of a subject variable is important, and should reflect its intended domain meaning <em>with respect to the guideline or plan</em> which it formalises. Thus, a cardiology guideline might use a variable <code>systolic_bp</code> to mean 'current instantaneous systolic blood pressure' and a variable <code>target_systolic_bp</code> to mean a target pressure for the patient to aim for over the course of hypertension treatment. However a guideline that refers to different systolic blood pressures, e.g. historical, average and current might use variables such as <code>actual_systolic_bp</code>, <code>24h_average_systolic_bp</code> etc.</p>
</div>
<div class="paragraph">
<p>The naming is important in another way. Generally a subject variable should reflect a fact or assertion about the subject in reality rather than a purely epistemic view relating to an information system. For example a variable <code>is_type1_diabetic</code> is intended to reflect the patient&#8217;s real diabetic status, not just the knowledge of the local hospital EMR system of whether the patient is diabetic. Such variables may be termed 'ontic' i.e. reflecting the real world, rather than reflecting states of knowledge of some information source. The reason for using ontic variables is to allow DLM authors to define rules in terms of true clinical reality based on reliable previously established facts, rather than continually having to compensate for missing or unreliable knowledge within a guideline.</p>
</div>
<div class="paragraph">
<p>Epistemic variables may of course be defined, e.g. the variable <code>has_diabetes_diagnosis</code> directly reflects the idea that the presence of a diagnosis of a condition is distinct from the true fact of having the condition. These are typically used when the purpose of the guideline is to establish the presence or otherwise of the condition named in such variables.</p>
</div>
</div>
<div class="sect3">
<h4 id="_currency"><a class="anchor" href="#_currency"></a>3.8.2. Currency</h4>
<div class="paragraph">
<p>The declaration may include a number of other elements. Firstly, since each such variable represents a fact about the subject in the real world, such as a patient heart-rate or diagnosis, rather than just being a local variable, the declaration may state a <em>currency</em>, in terms of a temporal duration. This specifies how recent the value obtained from the external world (the 'sample') must be to be valid from the point of view of the DLM. Currency may be understood as the converse of 'staleness', that is, a variable sample that must be say 1 hour or less old is understood as stale after 1 hour.</p>
</div>
<div class="paragraph">
<p>The use of the currency modifier establishes that a subject variable is a time-related sample of some kind (instantaneous, average, minimum, etc) of a real-world time-varying continuant quality (e.g. blood pressure) of an independent continuant entity (usually a person).</p>
</div>
<div class="paragraph">
<p>Since the various physiological and disease process that occur in a human body have significantly differing temporal rhythms, currency will vary widely for different subject variables, as per the following examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span><span class="tok-n">input</span>
    <span class="tok-p">|</span>
    <span class="tok-p">|</span> <span class="tok-n">DOB</span> <span class="tok-n">never</span> <span class="tok-n">changes</span><span class="tok-p">,</span> <span class="tok-n">no</span> <span class="tok-n">currency</span> <span class="tok-n">needed</span>
    <span class="tok-p">|</span>
    <span class="tok-n">date_of_birth</span><span class="tok-p">:</span> <span class="tok-n">Date</span>

    <span class="tok-p">|</span>
    <span class="tok-p">|</span> <span class="tok-n">weight</span> <span class="tok-n">changes</span> <span class="tok-n">over</span> <span class="tok-n">a</span> <span class="tok-n">period</span> <span class="tok-n">of</span> <span class="tok-n">days</span>
    <span class="tok-p">|</span>
    <span class="tok-n">weight</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span>
        <span class="tok-n">currency</span> <span class="tok-p">=</span> <span class="tok-m">3</span> <span class="tok-n">days</span>

    <span class="tok-p">|</span>
    <span class="tok-p">|</span> <span class="tok-n">assuming</span> <span class="tok-n">an</span> <span class="tok-n">adult</span> <span class="tok-n">subject</span><span class="tok-p">,</span> <span class="tok-n">height</span> <span class="tok-n">constant</span>
    <span class="tok-p">|</span>
    <span class="tok-n">height</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span>

    <span class="tok-p">|</span>
    <span class="tok-p">|</span> <span class="tok-n">blood</span> <span class="tok-n">glucose</span> <span class="tok-n">changes</span> <span class="tok-n">within</span> <span class="tok-n">minutes</span> <span class="tok-k">in</span> <span class="tok-n">response</span> <span class="tok-n">to</span> <span class="tok-n">food</span>
    <span class="tok-p">|</span>
    <span class="tok-n">blood_glucose</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span>
        <span class="tok-n">currency</span> <span class="tok-p">=</span> <span class="tok-m">15</span> <span class="tok-n">min</span>

    <span class="tok-p">|</span>
    <span class="tok-p">|</span> <span class="tok-n">Heart</span><span class="tok-p">-</span><span class="tok-n">rate</span> <span class="tok-n">may</span> <span class="tok-n">change</span> <span class="tok-n">quickly</span>
    <span class="tok-p">|</span>
    <span class="tok-n">heart_rate</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span>
        <span class="tok-n">currency</span> <span class="tok-p">=</span> <span class="tok-m">5</span> <span class="tok-n">sec</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables for which no currency is stated may be understood as having the currency equal to the age of the subject.</p>
</div>
</div>
<div class="sect3">
<h4 id="_time_window"><a class="anchor" href="#_time_window"></a>3.8.3. Time-window</h4>
<div class="paragraph">
<p>Another aspect of a subject variable that can be specified is termed <em>time-window</em>, meaning an interval of real world time within which the state or event that the variable represents occurred. For example, assume the variable <code>previous_history_of_eclampsia</code> declared in an obstetric DLM is intended to represent 'eclampsia experienced by the subject in any previous pregnancy (i.e. not the current pregnancy)'. Another guideline might define a variable <code>no_cancer_last_5y</code> to mean that no recurrence of the cancer addressed by the DLM had occurred within the last 5 years.</p>
</div>
<div class="paragraph">
<p>Formally, time window is specified in the form of an interval of negative durations with respect to the current point in time, i.e. of the form <code>|-T1 .. -T2|</code>, e.g. <code>|-P3Y .. -P1Y|</code>, meaning 'the period from 3 years ago to 1 year ago'. A single-sided interval such as <code>|&gt; -P30d|</code> ('since 30 days ago') may also be used.</p>
</div>
<div class="paragraph">
<p>Since the actual duration of a time-window may be subject- and/or context-specific, a symbolic variable may also be used, whose value is supplied by the execution context. For example, the variables <code>tw_current_episode</code> and <code>tw_historical</code> could be used to represent respectively:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the interval of the current admission, i.e. date/time of admission until now;</p>
</li>
<li>
<p>the interval of historical time up until the start of the current episode of condition.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Time window can be included in a subject variable declaration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span><span class="tok-n">input</span>
    <span class="tok-n">has_previous_history_of_eclampsia</span><span class="tok-p">:</span> <span class="tok-n">Boolean</span>
        <span class="tok-n">time_window</span> <span class="tok-p">=</span> <span class="tok-n">tw_historical</span>

    <span class="tok-n">has_pregnancy_related_hypertension</span><span class="tok-p">:</span> <span class="tok-n">Boolean</span>
        <span class="tok-n">time_window</span> <span class="tok-p">=</span> <span class="tok-n">tw_current_episode</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Time window is typically used to ensure that for a kind of event, condition or other characteristic that may occur multiply in the subject lifetime, only occurrences from a particular period are included or excluded. For example, the following declarations ensure that the variable <code>staging</code> and <code>has_metastases</code> refer to the staging and metastases of the current eposide of cancer, not some previous one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span><span class="tok-n">input</span>

    <span class="tok-n">staging</span><span class="tok-p">:</span> <span class="tok-n">Terminology_term</span> <span class="tok-err">«</span><span class="tok-n">ann_arbor_staging</span><span class="tok-err">»</span>
        <span class="tok-n">time_window</span> <span class="tok-p">=</span> <span class="tok-n">tw_current_episode</span>

    <span class="tok-n">has_metastases</span><span class="tok-p">:</span> <span class="tok-n">Boolean</span>
        <span class="tok-n">time_window</span> <span class="tok-p">=</span> <span class="tok-n">tw_current_episode</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In general, if <code>currency</code> is specified, <code>time_window</code> is not.</p>
</div>
<div class="paragraph tbd">
<p>TBD: determine if there is a meaning for both together.</p>
</div>
</div>
<div class="sect3">
<h4 id="_variable_ranges"><a class="anchor" href="#_variable_ranges"></a>3.8.4. Variable Ranges</h4>
<div class="paragraph">
<p>A ubiquitous need within clinical guidelines and rules is to be able to refer to a continuous variable such as vital signs and most lab test values as being in a designated range. Such ranges may be the usual ones published e.g. the normal and high ranges for lipids in a cholesterol test for adults, or ranges defined by the DLM.</p>
</div>
<div class="paragraph tbd">
<p>TBD: for now ranges have to be declared locally</p>
</div>
<div class="paragraph">
<p>The ranges for a subject variable may be declared in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span><span class="tok-n">input</span>
    <span class="tok-n">systolic_blood_pressure</span><span class="tok-p">:</span> <span class="tok-n">Quantity</span>
        <span class="tok-n">currency</span> <span class="tok-p">=</span> <span class="tok-m">1</span> <span class="tok-n">min</span>
        <span class="tok-n">ranges</span> <span class="tok-p">=</span> <span class="tok-p">{</span>
<span class="tok-na">            [critical_high]</span><span class="tok-p">:</span>  <span class="tok-p">|&gt;=</span> <span class="tok-m">180</span> <span class="tok-n">mm</span><span class="tok-p">[</span><span class="tok-n">Hg</span><span class="tok-p">]|,</span>
<span class="tok-na">            [very_high]</span><span class="tok-p">:</span>      <span class="tok-p">|&gt;</span>  <span class="tok-m">140</span> <span class="tok-n">mm</span><span class="tok-p">[</span><span class="tok-n">Hg</span><span class="tok-p">]|,</span>
<span class="tok-na">            [high]</span><span class="tok-p">:</span>           <span class="tok-p">|&gt;</span>  <span class="tok-m">120</span> <span class="tok-n">mm</span><span class="tok-p">[</span><span class="tok-n">Hg</span><span class="tok-p">]|,</span>
<span class="tok-na">            [normal]</span><span class="tok-p">:</span>         <span class="tok-p">|&gt;</span><span class="tok-m">90</span> <span class="tok-n">mm</span><span class="tok-p">[</span><span class="tok-n">Hg</span><span class="tok-p">]</span> <span class="tok-p">..</span> <span class="tok-p">&lt;=</span> <span class="tok-m">120</span> <span class="tok-n">mm</span><span class="tok-p">[</span><span class="tok-n">Hg</span><span class="tok-p">]|,</span>
<span class="tok-na">            [low]</span><span class="tok-p">:</span>            <span class="tok-p">|&lt;=</span>  <span class="tok-m">90</span> <span class="tok-n">mm</span><span class="tok-p">[</span><span class="tok-n">Hg</span><span class="tok-p">]|,</span>
<span class="tok-na">            [critical_low]</span><span class="tok-p">:</span>   <span class="tok-p">|&lt;=</span>  <span class="tok-m">50</span> <span class="tok-n">mm</span><span class="tok-p">[</span><span class="tok-n">Hg</span><span class="tok-p">]|</span>
        <span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The formal type of the <code>ranges</code> property is <code>Hash &lt;Terminology_code, Interval &lt;T&gt;&gt;</code>, where <code>T</code> is the declared type of the subject variable. Thus, in the above, the entry <code>[very_high], |&gt;  140 mm[Hg]|</code> defines a [key, value] pair whose value is of type <code>Interval &lt;Quantity&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Note that the ranges are defined to be overlapping, such that <code>[high]</code> refers to any value higher than 120, while <code>[very_high]</code> refers to any value over 140.</p>
</div>
<div class="paragraph">
<p>The above declaration allows the use of the predefined <code>in_range</code> function, which returns the most precise range in which the value falls, in rule expressions as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">Result</span> <span class="tok-p">:=</span>
        <span class="tok-p">========================================================</span>
        <span class="tok-n">systolic_blood_pressure</span>
            <span class="tok-p">.</span><span class="tok-n">in_range</span> <span class="tok-p">([</span><span class="tok-n">critical_high</span><span class="tok-p">]):</span>           <span class="tok-p">[</span><span class="tok-n">emergency</span><span class="tok-p">],</span>
        <span class="tok-p">--------------------------------------------------------</span>
        <span class="tok-n">systolic_blood_pressure</span>
            <span class="tok-p">.</span><span class="tok-n">in_range</span> <span class="tok-p">({[</span><span class="tok-n">high</span><span class="tok-p">],</span> <span class="tok-p">[</span><span class="tok-n">very_high</span><span class="tok-p">]}):</span>     <span class="tok-p">[</span><span class="tok-n">high_risk</span><span class="tok-p">],</span>
        <span class="tok-p">--------------------------------------------------------</span>
        <span class="tok-p">*:</span>                                         <span class="tok-p">[</span><span class="tok-n">monitor</span><span class="tok-p">]</span>
        <span class="tok-p">========================================================</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_null_values"><a class="anchor" href="#_null_values"></a>3.8.5. Null Values</h4>
<div class="paragraph">
<p>A subject variable declaration of the form <code>identifier: Type</code> means that the variable cannot be null, i.e. it must always be <em>attached</em>. A variable can be declared as <em>nullable</em> to indicate that no value can be found for it in the external world, i.e. that it may be <em>undefined</em>. This is done via the appending of the '?' symbol to the type, as in some programming languages, as per the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span><span class="tok-n">input</span>
    <span class="tok-n">date_of_decease</span><span class="tok-p">:</span> <span class="tok-n">Date</span><span class="tok-p">?</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rules_section"><a class="anchor" href="#_rules_section"></a>3.9. Rules Section</h3>
<div class="paragraph">
<p>The <code>rules</code> section contains various kinds of rules, expressed as functions in the <a href="https://specifications.openehr.org/releases/LANG/latest/expression_language.html" target="_blank" rel="noopener">openEHR Expression Language</a>, based on the <a href="https://specifications.openehr.org/releases/LANG/latest/bmm.html" target="_blank" rel="noopener">openEHR BMM</a>.</p>
</div>
<div class="paragraph">
<p>This section may be typically divided into two or more groups for authoring convenience. The first group may be used for simple Boolean-returning 0-order functions that represent 'named conditions', for use in the primary rules. The <code>Boolean</code> type may be omitted, since all conditions have this type. The following is an example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span><span class="tok-n">rules</span> <span class="tok-p">--</span> <span class="tok-n">Conditions</span>

    <span class="tok-n">her2_positive</span><span class="tok-p">:</span>
        <span class="tok-n">her2_expression</span> <span class="tok-p">=</span> <span class="tok-p">[</span><span class="tok-n">positive</span><span class="tok-p">]</span>

    <span class="tok-n">non_class_I_heart_failure</span><span class="tok-p">:</span>
        <span class="tok-n">has_diagnosis</span> <span class="tok-p">({[</span><span class="tok-n">heart_failure_class_II</span><span class="tok-p">],</span>
<span class="tok-na">                    [heart_failure_class_III]</span><span class="tok-p">,</span>
<span class="tok-na">                    [heart_failure_class_IV]</span><span class="tok-p">})</span>

    <span class="tok-n">anthracyclines_contraindicated</span><span class="tok-p">:</span>
        <span class="tok-n">has_diagnosis</span> <span class="tok-p">([</span><span class="tok-n">transmural_MI</span><span class="tok-p">])</span> <span class="tok-n">or</span>
        <span class="tok-n">ejection_fraction</span><span class="tok-p">.</span><span class="tok-n">in_range</span> <span class="tok-p">([</span><span class="tok-n">low</span><span class="tok-p">])</span> <span class="tok-n">or</span>
        <span class="tok-n">non_class_I_heart_failure</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The primary rules may be included in a separate <code>rules</code> group, consisting of 0-order functions returning any type. EL structures of any complexity may be used. The following provides an exmaple.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span><span class="tok-n">rules</span> <span class="tok-p">--</span> <span class="tok-n">Main</span>

    <span class="tok-n">hypertension_risk</span><span class="tok-p">:</span> <span class="tok-n">Terminology_term</span>
        <span class="tok-n">Result</span> <span class="tok-p">:=</span>
            <span class="tok-p">===========================================================</span>
            <span class="tok-n">has_pre_eclampsia</span> <span class="tok-n">or</span>
            <span class="tok-n">has_eclampsia</span><span class="tok-p">:</span>                      <span class="tok-p">[</span><span class="tok-n">obstetric_emergency</span><span class="tok-p">],</span>
            <span class="tok-p">-----------------------------------------------------------</span>
            <span class="tok-n">previous_obstetric_hypertension</span> <span class="tok-n">or</span>
            <span class="tok-n">previous_pre_eclampsia</span> <span class="tok-n">or</span>
            <span class="tok-n">previous_eclampsia</span> <span class="tok-n">or</span>
            <span class="tok-n">has_pregnancy_hypertension</span><span class="tok-p">:</span>         <span class="tok-p">[</span><span class="tok-n">refer_high_risk_care</span><span class="tok-p">],</span>
            <span class="tok-p">-----------------------------------------------------------</span>
            <span class="tok-p">*:</span>                                  <span class="tok-p">[</span><span class="tok-n">normal_obstetric_care</span><span class="tok-p">]</span>
            <span class="tok-p">===========================================================</span>

    <span class="tok-n">gestational_diabetes_risk</span><span class="tok-p">:</span> <span class="tok-n">Boolean</span>
        <span class="tok-n">Result</span> <span class="tok-p">:=</span>
            <span class="tok-n">bmi</span><span class="tok-p">.</span><span class="tok-n">in_range</span> <span class="tok-p">([</span><span class="tok-n">high</span><span class="tok-p">])</span> <span class="tok-n">or</span>
            <span class="tok-n">previous_macrosomic_baby</span> <span class="tok-n">or</span>
            <span class="tok-n">previous_gestational_diabetes</span> <span class="tok-n">or</span>
            <span class="tok-n">family_history_of_diabetes</span> <span class="tok-n">or</span>
            <span class="tok-n">race_related_diabetes_risk</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_output_section"><a class="anchor" href="#_output_section"></a>3.10. Output Section</h3>
<div class="paragraph tbd">
<p>TBD:</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_decision_logic_model_dlm"><a class="anchor" href="#_the_decision_logic_model_dlm"></a>4. The Decision Logic Model (DLM)</h2>
<div class="sectionbody">
<div class="paragraph tbd">
<p>TBD: this section is a rough draft at the moment</p>
</div>
<div class="sect2">
<h3 id="_overview_2"><a class="anchor" href="#_overview_2"></a>4.1. Overview</h3>
<div class="paragraph">
<p>The <code>org.openehr.proc.dlm</code> package defines the Decision Logic Model (DLM), a structural model of the openEHR Decision Language. It relies on the <a href="https://specifications.openehr.org/releases/LANG/latest/bmm.html" target="_blank" rel="noopener">openEHR BMM</a>.</p>
</div>
<div class="paragraph">
<p>The structure of the <code>dlm</code> packages is shown below.</p>
</div>
<div id="DLM_packages" class="imageblock text-center text-center">
<div class="content">
<img src="UML/diagrams/PROC-dlm-packages.svg" alt="PROC dlm packages" width="50%">
</div>
<div class="title">Figure 1. proc.dlm Package</div>
</div>
<div class="paragraph">
<p>The packages are described below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ds_module_package"><a class="anchor" href="#_ds_module_package"></a>4.2. DS Module Package</h3>
<div class="paragraph">
<p>The top-level construct of the DLM is the <code>DS_MODULE</code>, representing a standalone Decision Logic Module. It is shown below.</p>
</div>
<div id="DLM_module" class="imageblock text-center text-center">
<div class="content">
<img src="UML/diagrams/PROC-dlm.module.svg" alt="PROC dlm.module">
</div>
<div class="title">Figure 2. proc.DLM.module Package</div>
</div>
<div class="paragraph tbd">
<p>TBD: to be continued.</p>
</div>
<div class="sect3">
<h4 id="_class_descriptions"><a class="anchor" href="#_class_descriptions"></a>4.2.1. Class Descriptions</h4>
<div class="sect4">
<h5 id="_decision_module_class"><a class="anchor" href="#_decision_module_class"></a>4.2.1.1. DECISION_MODULE Class</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 55.5556%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Class</strong></p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>DECISION_MODULE</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Description</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p>A container for a set of statements along with related BMM definitions, meta-data, terminology and bindings.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Inherit</strong></p></th>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><a href="/releases/BASE/latest/resource.html#_authored_resource_class" target="_blank" rel="noopener">AUTHORED_RESOURCE</a></code>, <code><a href="/releases/LANG/latest/bmm.html#_bmm_class_class" target="_blank" rel="noopener">BMM_CLASS</a></code></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Attributes</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>0..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>proxy_properties</strong>: <code><a href="/releases/BASE/latest/foundation_types.html#_list_class">List<sup></a>&lt;<a href="/releases/LANG/latest/bmm.html#_bmm_property_class">BMM_PROPERTY</sup></a>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Properties representing real-world objects, such as the patient state, the patient history (logical EHR) etc.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>0..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>definitions</strong>: <code><a href="/releases/BASE/latest/foundation_types.html#_list_class">List<sup></a>&lt;<a href="/releases/LANG/latest/bmm.html#_bmm_constant_class">BMM_CONSTANT</sup></a>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Constant definitions needed by module.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Functions</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Signature</strong></p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>Meaning</strong></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock"><strong>0..1</strong></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>create_bmm_class</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Generate a <code>BMM_CLASS</code> structure in which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>constants</em></code> = <code><em>this.definitions</em></code>;</p>
</li>
<li>
<p><code><em>this.conditions</em></code> are converted to <code>Boolean</code>-returning functions with no parameters whose <code><em>body</em></code> is a single assignment statement of the form <code>Result</code> = <code>DL_CONDITION_DEF.<em>definition</em></code>;</p>
</li>
<li>
<p><code><em>this.rules</em></code> are converted to <code>Boolean</code>-returning functions with no parameters whose <code><em>body</em></code> consists of the <code>DL_CONDITION_RULE.<em>body</em></code>.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ds_rules_package"><a class="anchor" href="#_ds_rules_package"></a>4.3. DS Rules Package</h3>
<div class="paragraph">
<p>Specific Rule types are defined as descendants of <code>DS_RULE</code>, which may be understood as a pseudo form of the <code>BMM_FUNCTION</code> meta-type, i.e. a particular kind of function with a <code><em>body</em></code>. The following UML view illustrates.</p>
</div>
<div class="paragraph">
<p>Some specific rule types are described below.</p>
</div>
<div class="sect3">
<h4 id="_condition_chain_rule"><a class="anchor" href="#_condition_chain_rule"></a>4.3.1. Condition Chain Rule</h4>
<div class="paragraph">
<p>A DS <em>condition chain rule</em> is one that consists of a chain of condition / result pairs and an 'else' result to cover a failure to match any condition. It is illustrated in the following UML view.</p>
</div>
</div>
<div class="sect3">
<h4 id="_case_rule"><a class="anchor" href="#_case_rule"></a>4.3.2. Case Rule</h4>
<div class="paragraph">
<p>A DS <em>case rule</em> is one that obtains a value from an expression and determines the Result based on the interval in which the value falls. It is the equivalent of a 'case' statement in many languages. The match criterion on each branch of the rule is specified in terms of <code>C_PRIMITIVE</code> constraint types, from the <a href="https://specifications.openehr.org/releases/AM/latest/index">openEHR AOM2 model</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_class_descriptions_2"><a class="anchor" href="#_class_descriptions_2"></a>4.3.3. Class Descriptions</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-09-09 14:46:53 +0100
</div>
</div>
<link rel="stylesheet" href="https://specifications.openehr.org/styles/pygments-default.css">
</body>
</html>