= Examples

The following examples rely on the 'Core Patient' and extension Subject Proxies defined in the {openehr_subject_proxy}#_core_patient_proxy[openEHR Subject Proxy Specification^].

== Perinatal Care

=== GDL3 Dataset

----
gdl3_dataset Pregnant_patient_DS 

extend
    Core_patient_DS
    
state -- <time_window = "all">

    is_pregnant: Boolean

    is_type1_diabetic: Boolean

    previous_obstetric_hypertension: Boolean

    previous_pre_eclampsia: Boolean

    previous_eclampsia: Boolean

state -- <time_window = "current_episode">

    has_gestational_diabetes: Boolean

    has_pregnancy_hypertension: Boolean 

    has_pre_eclampsia: Boolean

    has_eclampsia: Boolean

state -- <time_window = "live">

    amniotic_fluid_state: Terminology_term

    uterine_fundal_height: Quantity

    vaginal_blood_flow: Quantity
        currency = 30mins
        ranges =
            critical_high: |> 500 mL/hr|


state -- <time_window = "live", source = "manual">

    haemorrhage: Boolean

    contractions_commenced: Boolean

    braxton_hicks_contraction: Boolean

----

=== GDL3 Gudeline

----
gdl3_guideline Obstetric_pregnancy 

use 
    Pregnant_patient_DS
    
preconditions

    is_pregnant

rules

    anaemia_type: Terminology_term
        Result <- 
            if not has_diagnosis (87522002|anaemia|, |>= Current_episode.start|)
                |excluded|
            else
                diagnosis (87522002|anaemia|, |>= Current_episode.start|)

    risk_evaluation: Terminology_term
        ....
        
    amniotic_fluid_risk: Terminology_term
        Result <- 
            map hypertension_state
                {44223004|premature rupture|, 
                 86203003|polyhydramnios|}      -> |obstetric emergency|9999
                {59566000|oligohydramnios|}     -> |refer high risk care|1111
                {*}                             -> |normal|0000
    
    hypertension_risk: Terminology_term
        if has_pre_eclampsia or has_eclampsia
            Result <- |obstetric emergency|9999
            
        elseif previous_obstetric_hypertension or previous_pre_eclampsia or 
                previous_eclampsia or has_pregnancy_hypertension
            Result <- |refer high risk antenatal care|1111
            
        else
            Result <- |normal|0000
            
    diabetes_risk: Terminology_term
        if has_gestational_diabetes
            Result <- |refer high risk antenatal care|1111
        else
            Result <- |normal|0000
            
    anaemia_risk: Terminology_term
        Result <- 
            map anaemia_type
                {27342004|anaemia of pregnancy|, 
                 |severe|}                          -> |obstetric emergency|9999
                {27342004|anaemia of pregnancy|}    -> |refer high risk care|1111
                {*}                                 -> |normal|0000
    
    
----

== Breast Cancer Decision Protocol

=== GDL3 Dataset

Breast cancer specific dataset.

----
gdl3_dataset Breast_cancer_patient_DS 

extend
    Cancer_patient_DS
    
state -- <time_window = "current_episode">

    tnm_t: String
        currency = 60 days

    tnm_n: String
        currency = 60 days

    tnm_m: String
        currency = 60 days

    tnm_g: String
        currency = 60 days

    estrogen_receptor: Terminology_term «pos_neg_vs»
        currency = 60 days

    progesterone_receptor:  Terminology_term «pos_neg_vs»
        currency = 60 days

    her2_expression: Terminology_term «pos_neg_vs»
        currency = 60 days

    ki67: Quantity
        currency = 60 days

    ejection_fraction: Quantity
        currency = 60 days
                
derived
    er_negative:
        estrogen_receptor = |negative|

    er_positive:
        estrogen_receptor = |positive|
        
    pr_negative:
        progesterone_receptor = |negative|

    pr_positive:
        progesterone_receptor = |positive|
        
    her2_negative:
        her2_expression = |negative|

    her2_positive:
        her2_expression = |positive|

----

=== GDL3 Guideline

----
gdl3_guideline Oncology_breast_cancer 

use
    Breast_cancer_patient_DS

definitions
    ki67_threshold: Quantity = 14%
    
conditions

    ki67_high:
        ki67 >= ki67_threshold
        
    anthracyclines_contraindicated:
        has_diagnosis (|Transmural MI|) or
        ejection_fraction < 40% or
        has_diagnosis ({|heart failure (class II)|, 
                        |heart failure (class III)|,
                        |heart failure (class IV)|})
                                
    taxanes_contraindicated:
        is_type1_diabetic or
        has_allergy (|taxanes|) or 
        has_DSntolerance (|taxanes|)
        
rules

    molecular_subtype: Terminology_term
        if er_positive and her2_negative and not ki67_high
            Result <- |Luminal A|

        elseif er_positive and her2_negative and ki67_high
            Result <- |Luminal B (HER2 negative)|

        elseif er_positive and her2_positive
            Result <- |Luminal B (HER2 positive)|

        elseif er_negative and pr_negative and her2_positive and ki67_high
            Result <- |HER2|

        elseif er_negative and pr_negative and her2_negative and ki67_high
            Result <- |Triple negative|
            
        else 
            Result <- |none|
    
    chemotherapy_regime: Terminology_term
        if not metastatic 
            if molecular_subtype in {|Luminal B (HER2 negative)|, |Triple negative|} and
                    (tnm_t > '1a' or tnm_n > '0')
                Result <- |taxanes|
            
            elseif molecular_subtype = |Luminal A| and 
                    (tnm_t >= '3' or tnm_n >= '2' or tnm_g >= '3')
                Result <- |anthracyclines|
            
            elseif molecular_subtype = |Luminal B (HER2 positive)| and 
                    (tnm_t = '1b' or tnm_t = '1c' and tnm_n = '0')
                    or
                    molecular_subtype = |HER2| and 
                    (tnm_t = '1b' and tnm_n = '0')
                Result <- |paditaxel + trastuzumab|
            else ...
                Result <-
            
        else -- metastatic
            if ...
                Result <-
            elseif ...
                Result <-
            else
                Result <-

----
